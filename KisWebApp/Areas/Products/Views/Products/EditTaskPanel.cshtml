@model KIS.App_Code.TaskVariante

<script>
    $(document).ready(function () {

        var initTaskName = $('#txtTaskName').val();
        var initTaskDesc = $('#txtTaskDesc').val();
        $('#imgLoadSaveTaskDetails').fadeOut();
        $('#imgLoadAddCycleTime').fadeOut();
        $('#trCT1').fadeOut();
        $('#trCT2').fadeOut();
        $('#trCT3').fadeOut();
        $('#trCT4').fadeOut();
        $('#trCT5').fadeOut();
        loadCycleTimes();
        $('#trPAR1').fadeOut();
        $('#trPAR2').fadeOut();
        $('#trPAR3').fadeOut();
        $('#trPAR4').fadeOut();
        $('#trPAR5').fadeOut();
        $('#trPAR6').fadeOut();
        loadTaskParameters();
        $('#imgLoadAddTaskParam').fadeOut();
        $('#imgLoadWorkInstructions').fadeOut();
        $('#imgLoadDefaultOperators').fadeOut();
        $("#frmAddDefaultOperator").fadeOut();
        $("#frmAddMicrostep").fadeOut();
        //loadTaskManuals();

        $('#btnUndoTaskDetails').click(function () {
            $('#txtTaskName').val(initTaskName);
            $('#txtTaskDesc').val(initTaskDesc);
            return false;
        });

        $('#btnSaveTaskDetails').click(function () {
            $('#imgLoadSaveTaskDetails').fadeIn();
            $('#btnSaveTaskDetails').fadeOut();
            $('#btnUndoTaskDetails').fadeOut();
            $('#lblInfoSaveTaskDetails').html('');

            $.ajax({
                url: "@Url.Action("SaveTaskDetails", "Products")",
                type: 'GET',
                dataType: 'html',
                data: {
                    TaskID: @ViewBag.TaskID,
                    TaskRev: @ViewBag.TaskRev,
                    variantID: @ViewBag.VariantID,
                    TaskName: $('<div/>').text($('#txtTaskName').val()).html(),
                    TaskDescription: $('<div/>').text($('#txtTaskDesc').val()).html(),
                },
                success: function (result) {
                    if (result == "False") {
                        alert("@ResProducts.EditTaskPanel.lblDetailEditTaskError");
                        $('#imgLoadSaveTaskDetails').fadeOut();
                        $('#btnSaveTaskDetails').fadeIn();
                        $('#btnUndoTaskDetails').fadeIn();
                    }
                    else {
                        $('#lblInfoSaveTaskDetails').html('@ResProducts.EditTaskPanel.lblDetailEditSuccess');
                        $('#imgLoadSaveTaskDetails').fadeOut();
                        $('#btnSaveTaskDetails').fadeIn();
                        $('#btnUndoTaskDetails').fadeIn();
                    }
                },
                error: function (result) {
                    alert("@ResProducts.EditTaskPanel.lblDetailEditError");
                    $('#imgLoadSaveTaskDetails').fadeOut();
                    $('#btnSaveTaskDetails').fadeIn();
                    $('#btnUndoTaskDetails').fadeIn();
                },
                warning: function (result) {
                    alert("@ResProducts.EditTaskPanel.lblDetailEditError");
                    $('#imgLoadSaveTaskDetails').fadeOut();
                    $('#btnSaveTaskDetails').fadeIn();
                    $('#btnUndoTaskDetails').fadeIn();
                }
            });
            return false;
        });

        $('#btnResetCycleTime').click(function () {
            $('#txtCTHours').val('0');
            $('#txtCTMinutes').val('0');
            $('#txtCTSeconds').val('0');
            $('#txtSTHours').val('0');
            $('#txtSTMinutes').val('0');
            $('#txtSTSeconds').val('0');
            $('#txtCTNumOps').val('1');
            $('#chkCTDefault').prop("checked", false);
            return false;
        });

        $('#btnAddCycleTime').click(function () {
            var nOps = parseInt($('#txtCTNumOps').val());
            var CTs = parseInt($('#txtCTSeconds').val());
            var CTm = parseInt($('#txtCTMinutes').val());
            var CTh = parseInt($('#txtCTHours').val());
            var STs = parseInt($('#txtSTSeconds').val());
            var STm = parseInt($('#txtSTMinutes').val());
            var STh = parseInt($('#txtSTHours').val());
            var def = false;
            if ($('#chkCTDefault').is(":checked")) {
                def = true;
            }

            if(nOps > 0 && STh >= 0 && CTh >=0 && CTm <60 && CTm >=0 && CTs <60 && CTs >=0 && STm <60 && STm >=0 && STs <60 && STs >=0)
            {
                var sTime = STh*3600 + STm*60 + STs;
                var cTime = CTh*3600 + CTm*60 + CTs;

                $('#imgLoadAddCycleTime').fadeIn();
                $('#btnResetCycleTime').fadeOut();
                $('#btnAddCycleTime').fadeOut();
                $.ajax({
                    url: "@Url.Action("AddWorkingTimeToTask", "Products")",
                    type: 'GET',
                dataType: 'html',
                data: {
                    TaskID: @ViewBag.TaskID,
                    TaskRev: @ViewBag.TaskRev,
                    VariantID: @ViewBag.VariantID,
                    NumOps: nOps,
                    SetupTime: sTime,
                    CycleTime: cTime,
                    def: def
                    },
                success: function (result) {
                    if (result == "False") {
                        alert("@ResProducts.EditTaskPanel.lblDetailEditError");
                        $('#imgLoadAddCycleTime').fadeOut();
                        $('#btnResetCycleTime').fadeIn();
                        $('#btnAddCycleTime').fadeIn();
                    }
                    else {
                        loadCycleTimes();
                        $('#imgLoadAddCycleTime').fadeOut();
                        $('#btnResetCycleTime').fadeIn();
                        $('#btnAddCycleTime').fadeIn();
                        $('#trCT1').fadeOut();
                        $('#trCT2').fadeOut();
                        $('#trCT3').fadeOut();
                        $('#trCT4').fadeOut();
                        $('#trCT5').fadeOut();
                    }
                },
                error: function (result) {
                    alert("@ResProducts.EditTaskPanel.lblDetailEditError");
                    $('#imgLoadAddCycleTime').fadeOut();
                    $('#btnResetCycleTime').fadeIn();
                    $('#btnAddCycleTime').fadeIn();
                },
                warning: function (result) {
                    alert("@ResProducts.EditTaskPanel.lblDetailEditError");
                    $('#imgLoadAddCycleTime').fadeOut();
                    $('#btnResetCycleTime').fadeIn();
                    $('#btnAddCycleTime').fadeIn();
                }
            });
            }
            else
            {
                alert("@ResProducts.EditTaskPanel.lblWorkingTimeWrong");
            }
                return false;
        });

        function loadCycleTimes()
        {
            $('#imgLoadCycleTimes').fadeIn();
            $.ajax({
                url: "@Url.Action("TaskCycleTimesList", "Products")",
                type: 'GET',
                dataType: 'html',
                data:{
                    TaskID: @ViewBag.TaskID,
                    TaskRev: @ViewBag.TaskRev,
                    VariantID: @ViewBag.VariantID,
                },
                success: function (result) {
                    $('#listCycleTimes').html(result);
                    $('#imgLoadCycleTimes').fadeOut();
                },
                error: function (result) {
                    alert("Error");
                },
                warning: function (result) {
                    alert("Warning");
                }
            });
        }

        $('#showAddCycleTime').click(function () {
            if ($('#trCT1').is(':visible')) {
                $('#trCT1').fadeOut();
                $('#trCT2').fadeOut();
                $('#trCT3').fadeOut();
                $('#trCT4').fadeOut();
                $('#trCT5').fadeOut();
            }
            else
            {
                $('#trCT1').fadeIn();
                $('#trCT2').fadeIn();
                $('#trCT3').fadeIn();
                $('#trCT4').fadeIn();
                $('#trCT5').fadeIn();
            }
        });

        $('#showAddTaskParams').click(function () {
            if ($('#trPAR1').is(':visible')) {
                $('#trPAR1').fadeOut();
                $('#trPAR2').fadeOut();
                $('#trPAR3').fadeOut();
                $('#trPAR4').fadeOut();
                $('#trPAR5').fadeOut();
                $('#trPAR6').fadeOut();
            }
            else
            {
                $('#trPAR1').fadeIn();
                $('#trPAR2').fadeIn();
                $('#trPAR3').fadeIn();
                $('#trPAR4').fadeIn();
                $('#trPAR5').fadeIn();
                $('#trPAR6').fadeIn();
            }
        });

        function loadTaskParameters() {
            var TaskID = parseInt(@ViewBag.TaskID);
            var TaskRev = parseInt(@ViewBag.TaskRev);
            var VariantID = parseInt(@ViewBag.VariantID);
            if(TaskID != -1 && TaskRev!=-1 && VariantID!=-1)
            {
                $('#imgLoadParams').show();
                $.ajax({
                    url: "@Url.Action("TaskParametersList", "Products")",
                    type: 'GET',
                    dataType: 'html',
                    data:{
                        TaskID: TaskID,
                        TaskRev: TaskRev,
                        VariantID: VariantID
                    },
                    success: function (result) {
                        $('#divTaskParams').html(result);
                        $('#imgLoadParams').hide();
                    },
                    error: function(result){alert("Error");},
                    warning: function(result){alert("Warning");}
                });
            }
            else
            {
                $('#imgLoadParams').hide();
            }
        }

        $('#imgAddTaskParam').click(function () {
            $('#imgAddTaskParam').fadeOut();
            $('#imgLoadAddParam').fadeIn();
            var procID = parseInt(@ViewBag.TaskID);
            var procRev = parseInt(@ViewBag.TaskRev);
            var varID = parseInt(@ViewBag.VariantID);
            var paramName = $('<div/>').text($('#txtTaskParamName').val()).html();
            var paramDescription = $('<div/>').text($('#txtTaskParamDescription').val()).html();
            var paramIsFixed = false;
            if ($('#txtTaskParamIsFixed').is(":checked")) {
                var paramIsFixed = true;
            }
            var paramIsRequired = false;
            if ($('#txtTaskParamIsRequired').is(":checked")) {
                var paramIsRequired = true;
            }
            var paramCategory = parseInt($('#ddlTaskParamCategory').val());

            if(procID > -1 && procRev > -1 && varID > -1)
            {
                if (paramName.length > 0) {
                    if (paramCategory > -1)
                    {
                        $.ajax({
                            url: "@Url.Action("AddTaskParam", "Products")",
                            type: 'GET',
                            dataType: 'html',
                            data: {
                                TaskID: procID,
                                TaskRev: procRev,
                                variantID: varID,
                                ParamName: paramName,
                                ParamDescription: paramDescription,
                                ParamCategory: paramCategory,
                                ParamIsFixed: paramIsFixed,
                                ParamIsRequired: paramIsRequired
                            },
                            success: function (result) {
                                $('#imgAddTaskParam').fadeIn();
                                $('#imgLoadAddParam').fadeOut();
                                $('#addTaskParams').fadeOut();
                                loadTaskParameters();
                                $('#txtTaskParamName').val('');
                                $('#txtTaskParamDescription').val('');
                                $('#txtTaskParamIsFixed').attr('checked', false);
                                $('#txtTaskParamIsRequired').attr('checked', false);
                                $("#ddlTaskParamCategory").val('-1');
                                $('#trPAR1').fadeOut();
                                $('#trPAR2').fadeOut();
                                $('#trPAR3').fadeOut();
                                $('#trPAR4').fadeOut();
                                $('#trPAR5').fadeOut();
                                $('#trPAR6').fadeOut();
                            },
                            error: function(result)
                            {
                                $('#imgAddTaskParam').fadeIn();
                                $('#imgLoadAddParam').fadeOut();
                                alert("@ResProducts.EditTaskPanel.lblParamAddError");
                            },
                            warning: function (result)
                            {
                                $('#imgAddTaskParam').fadeIn();
                                $('#imgLoadAddParam').fadeOut();
                                alert("@ResProducts.EditTaskPanel.lblParamAddError");
                            }
                        });
                        loadTaskParameters();
                    }
                    else
                    {
                        alert("@ResProducts.EditTaskPanel.lblParamErrCategory");
                        $('#imgAddTaskParam').fadeIn();
                        $('#imgLoadAddParam').fadeOut();
                    }
                }
                else {
                    alert("@ResProducts.EditTaskPanel.lblParamErrName");
                    $('#imgAddTaskParam').fadeIn();
                    $('#imgLoadAddParam').fadeOut();
                }
            }
        });

        $("#imgAddWorkInstruction").on("click", function () {

            if ($('#addManual').is(':visible')) {
                $("#addManual").fadeOut();
            }
            else {
                $("#addManual").fadeIn();
            }
        });

        $(function () {
            $("[id*=manualExpiryDate]").datepicker({ dateFormat: 'dd/mm/yy' });
            $("[id*=manualInitialValidity]").datepicker({ dateFormat: 'dd/mm/yy' });
        });

        $("#imgLoadAddManual").fadeOut();

        $("#imgAddManual").on("click", function () {
            var TaskID = parseInt(@ViewBag.TaskID);
            var TaskRev = parseInt(@ViewBag.TaskRev);
            var varID = parseInt(@ViewBag.VariantID);
            $("#imgAddManual").fadeOut();
            $("#imgLoadAddManual").fadeIn();
            var sInitialDate = $("#manualInitialValidity").val();
            var sExpiryDate = $("#manualExpiryDate").val();

            var aInitialDate = sInitialDate.split('/');
            var aExpiryDate = sExpiryDate.split('/');
            if (aInitialDate.length == 3 && aExpiryDate.length == 3) {

                var i = new Date(aInitialDate[2], (aInitialDate[1]-1), aInitialDate[0]);
                var f = new Date(aExpiryDate[2], (aExpiryDate[1]-1), aExpiryDate[0]);
                if (i <= f) {

                    var g = $('#ddlWorkIstructions').val();
                    var id = $("#ddlWorkIstructionsList option[value='" + g + "']").attr('data-id');


                    if (!(typeof id === 'undefined')) {
                        var aWI = id.split(';');
                        if (aWI.length == 2 && $.isNumeric(aWI[0]) && $.isNumeric(aWI[1])) {

                            $.ajax({
                                url: "@Url.Action("LinkTaskToWorkInstruction", "Products")",
                                type: 'GET',
                                dataType: 'html',
                                data: {
                                    TaskID: TaskID,
                                    TaskRev: TaskRev,
                                    variantID: varID,
                                    WorkInstructionID: aWI[0],
                                    WorkInstructionVersion: aWI[1],
                                    InitialValidity: aInitialDate[2] + "-" + aInitialDate[1] + "-" + aInitialDate[0],
                                    EndValidity: aExpiryDate[2] + "-" + aExpiryDate[1] + "-" + aExpiryDate[0]
                                },
                                success: function (result) {
                                    if (result == "1") {
                                        $("#manualInitialValidity").val("");
                                        $("#manualExpiryDate").val("");
                                        $('#ddlWorkIstructions').val("");
                                        $("#imgLoadAddManual").fadeOut();
                                        $("#imgAddWorkInstruction").fadeOut();
                                        $("#addManual").fadeOut();

                                        //$("#tblManual")
                                        //$("#tblManual").empty();
                                        $("#tblManual tbody").append("<tr>"
                                            + "<td><input type='image' value='" + aWI[0] + ";" + aWI[1] + "' src='../img/iconDelete.png' style='max-width:20px; min-width:15px; cursor:pointer;' id='imgDeleteWorkInstruction' class='imgDeleteWorkInstruction' /></td>"
                                            + "<td>" + g + "</td>"
                                            + "<td>" + aInitialDate[0] + "/" + aInitialDate[1] + "/" + aInitialDate[2] + "</td>"
                                            + "<td>" + aExpiryDate[0] + "/" + aExpiryDate[1] + "/" + aExpiryDate[2] + "</td>"
                                            + "</tr>");
                                        $("#taskManuals").fadeIn();
                                        $("#tblManual").fadeIn();
                                    }
                                    else if (result == "4") {
                                        alert("@ResProducts.EditTaskPanel.lblWIErrOverlap");
                                        $("#imgLoadAddManual").fadeOut();
                                        $("#imgAddWorkInstruction").fadeIn();
                                        $("#imgAddManual").fadeIn();
                                    }
                                    else {
                                        alert("Generic error");
                                        $("#imgLoadAddManual").fadeOut();
                                        $("#imgAddWorkInstruction").fadeIn();
                                        $("#imgAddManual").fadeIn();
                                    }
                                },
                                error: function (result) {
                                    alert("Error");
                                },
                                warning: function (result) {
                                    alert("Warning");
                                }
                            });
                        }
                        else {
                            alert("Manual not recognized");
                        }
                    }
                } else {
                    alert("Error dates!");
                    $("#imgAddManual").fadeIn();
                    $("#imgLoadAddManual").fadeOut();
                }
            }
            else {
                alert("Invalid date formats");
            }

        });

        $("#taskManuals").on("click", ".imgDeleteWorkInstruction", function () {
            var TaskID = parseInt(@ViewBag.TaskID);
            var TaskRev = parseInt(@ViewBag.TaskRev);
            var varID = parseInt(@ViewBag.VariantID);
            var aWI = $(this).val().split(';');
            $(this).fadeOut();
            if (aWI.length == 2 && $.isNumeric(aWI[0]) && $.isNumeric(aWI[1])) {
                $.ajax({
                    url: "@Url.Action("DeleteTaskWorkInstruction", "Products")",
                    type: 'GET',
                    dataType: 'html',
                    data: {
                        TaskID: TaskID,
                        TaskRev: TaskRev,
                        variantID: varID,
                        WorkInstructionID: aWI[0],
                        WorkInstructionVersion: aWI[1],
                    },
                    success: function (result) {
                        $("#tblManual tr").remove();
                        $(this).fadeIn();
                        $("#taskManuals").fadeOut();
                        $("#imgLoadAddManual").fadeOut();
                        $("#imgAddWorkInstruction").fadeIn();
                        $("#imgAddManual").fadeIn();
                    },
                    error: function (result) {
                        $(this).fadeIn();
                        alert("Error");
                    },
                    warning: function (result) {
                        $(this).fadeIn();
                        alert("Warning");
                    }
                });
            }
            return false;
        });

        function loadDefaultOperators()
        {
            $('#imgLoadDefaultOperators').fadeIn();
            $.ajax({
                url: "@Url.Action("TaskDefaultOperatorsList", "Products")",
                type: 'GET',
                dataType: 'html',
                data:{
                    TaskID: @ViewBag.TaskID,
                    TaskRev: @ViewBag.TaskRev,
                    variantID: @ViewBag.VariantID,
                },
                success: function (result) {
                    $('#frmDefaultOperators').html(result);
                    $('#imgLoadDefaultOperators').fadeOut();
                },
                error: function (result) {
                    alert("Error");
                    $('#imgLoadDefaultOperators').fadeOut();
                },
                warning: function (result) {
                    alert("Warning");
                    $('#imgLoadDefaultOperators').fadeOut();
                }
            });
        }

        function loadMicrosteps()
        {
            $('#imgLoadMicrosteps').fadeIn();
            $.ajax({
                url: "@Url.Action("TaskMicrostepsList", "Products")",
                type: 'GET',
                dataType: 'html',
                data:{
                    TaskID: @ViewBag.TaskID,
                    TaskRev: @ViewBag.TaskRev,
                    variantID: @ViewBag.VariantID,
                },
                success: function (result) {
                    $('#frmMicrosteps').html(result);
                    $('#imgLoadMicrosteps').fadeOut();
                },
                error: function (result) {
                    alert("Error");
                    $('#imgLoadMicrosteps').fadeOut();
                },
                warning: function (result) {
                    alert("Warning");
                    $('#imgLoadDefaultOperators').fadeOut();
                }
            });
        }

        $("#showAddDefaultOperator").click(function () {
            if ($('#frmAddDefaultOperator').is(':visible')) {
                $("#frmAddDefaultOperator").fadeOut();
            }
            else {
                $("#frmAddDefaultOperator").fadeIn();
            }
        });

        $("#imgSaveDefaultOperator").click(function () {
            var usr = $("#defaultOperator").val();

            $.ajax({
                    url: "@Url.Action("AddDefaultOperator", "Products")",
                    type: 'GET',
                    dataType: 'html',
                    data: {
                        TaskID: @ViewBag.TaskID,
                        TaskRev: @ViewBag.TaskRev,
                        variantID: @ViewBag.VariantID,
                        user: usr,
                    },
                success: function (result) {
                    if (result == 1) {
                        loadDefaultOperators();
                        $("#frmAddDefaultOperator").fadeOut();
                    }
                    else {
                        alert("Error while adding a new operator");
                    }
                    },
                    error: function (result) {
                        alert("Error");
                    },
                    warning: function (result) {
                        alert("Warning");
                    }
                });

        });

        loadDefaultOperators();

        $("#showAddMicrostep").click(function () {
            if ($('#frmAddMicrostep').is(':visible')) {
                $("#frmAddMicrostep").fadeOut();
            }
            else {
                $("#frmAddMicrostep").fadeIn();
            }
        });

        $("#imgSaveMicrostep").click(function () {
            // var usr = $("#defaultOperator").val();
            var name = $('<div/>').text($('#addMicrostepName').val()).html();
            var description = $('<div/>').text($('#addMicrostepDescription').val()).html();
            var cycletime = $("#addMicrostepCycleTime").val();
            var valueorwaste = $("#addMicrostepValueOrWaste").val();
            var w_error = 0;

            if (name.length >= 255) {
                w_error = 1;
                alert("Name length too long");
            }

            if (description.length >= 255) {
                w_error = 1;
                alert("Description length too long");
            }

            if (cycletime < 0) {
                w_error = 1;
                alert("Invalid Cycle Time");
            }

            if (!(valueorwaste == 'W' || valueorwaste == 'H' || valueorwaste == 'V')) {
                w_error = 1;
                alert("Invalid Value Or Waste parameter");
            }

            if (w_error == 0) {

            $.ajax({
                    url: "@Url.Action("AddTaskMicrostep", "Products")",
                    type: 'GET',
                    dataType: 'html',
                    data: {
                        TaskID: @ViewBag.TaskID,
                        TaskRev: @ViewBag.TaskRev,
                        variantID: @ViewBag.VariantID,
                        MicrostepName: name,
                        MicrostepDescription: description,
                        MicrostepCycleTime: cycletime,
                        ValueOrWaste: valueorwaste
                    },
                success: function (result) {
                    if (result == 1) {
                        $('#addMicrostepName').val('');
                        $('#addMicrostepDescription').val('');
                        $("#addMicrostepCycleTime").val(0);
                        loadMicrosteps();
                    }
                    else {
                        alert("Error while adding the microstep");
                    }
                    },
                    error: function (result) {
                        alert("Error");
                    },
                    warning: function (result) {
                        alert("Warning");
                    }
            });
            }

        });

        loadMicrosteps();
        loadMicrosteps();

    });
</script>

@if (ViewBag.authW)
{

    <div class="row-fluid">
        <div class="span6">
            <table>
                <tr>
                    <td>@ResProducts.EditTaskPanel.lblTaskName</td>
                    <td>
                        <input type="text" id="txtTaskName" value="@Server.HtmlDecode(Server.HtmlDecode(Model.Task.processName))" />
                    </td>
                </tr>
                <tr>
                    <td>@ResProducts.EditTaskPanel.lblTaskDescription</td>
                    <td>
                        <textarea id="txtTaskDesc">@Server.HtmlDecode(Server.HtmlDecode(Model.Task.processDescription))</textarea>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align:center;">
                        <input type="image" id="btnSaveTaskDetails" style="min-width:20px; max-width:30px;" src="~/img/iconSave.jpg" />
                        <input type="image" id="btnUndoTaskDetails" style="min-width:20px; max-width:30px;" src="~/img/iconUndo.png" />
                        <img src="~/img/iconLoading.gif" id="imgLoadSaveTaskDetails" style="min-width:20px; max-width:30px;" />
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <div class="text-info" id="lblInfoSaveTaskDetails" />
                    </td>
                </tr>
                <tr>
                    <td style="text-align: center;" colspan="2" nowrap>
                        <h5>@ResProducts.EditTaskPanel.lblTitleCycleTimes&nbsp;<img src="~/img/iconAdd2.png" style="min-width:15px; max-width:30px; cursor:pointer;" id="showAddCycleTime" /></h5>
                    </td>
                </tr>
                <tr id="trCT1">
                    <td>@ResProducts.EditTaskPanel.lblCTNumOps</td>
                    <td><input type="number" id="txtCTNumOps" style="min-width:20px;max-width:40px;" min="1" value="1" /></td>
                </tr>
                <tr id="trCT2">
                    <td>@ResProducts.EditTaskPanel.lblCTSetupTime</td>
                    <td nowrap>
                        HH:<input type="number" id="txtSTHours" min="0" style="min-width:20px;max-width:40px;" value="0" />mm:<input type="number" id="txtSTMinutes" min="0" max="59" style="min-width:20px;max-width:40px;" value="0" />ss:<input type="number" id="txtSTSeconds" min="0" max="59" style="min-width:20px;max-width:40px;" value="0" />
                    </td>
                </tr>
                <tr id="trCT3">
                    <td>@ResProducts.EditTaskPanel.lblCTCycleTime</td>
                    <td nowrap>HH:<input type="number" id="txtCTHours" min="0" style="min-width:20px;max-width:40px;" value="0" />mm:<input type="number" id="txtCTMinutes" min="0" max="59" style="min-width:20px;max-width:40px;" value="0" />ss:<input type="number" id="txtCTSeconds" min="0" max="59" style="min-width:20px;max-width:40px;" value="0" /></td>
                </tr>
                <tr id="trCT4">
                    <td>@ResProducts.EditTaskPanel.lblDefault</td>
                    <td><input type="checkbox" id="chkCTDefault" checked="true" /></td>
                </tr>
                <tr id="trCT5">
                    <td colspan="2" style="text-align:center;">
                        <input type="image" id="btnAddCycleTime" style="min-width:20px; max-width:30px;" src="~/img/iconSave.jpg" />
                        <input type="image" id="btnResetCycleTime" style="min-width:20px; max-width:30px;" src="~/img/iconUndo.png" />
                        <img src="~/img/iconLoading.gif" id="imgLoadAddCycleTime" style="min-width:20px; max-width:30px;" />
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <img src="~/img/iconLoading.gif" id="imgLoadCycleTimes" style="min-width:20px; max-width:30px;" />
                        <div id="listCycleTimes" />
                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align: center;">
                        <h5>
                            @ResProducts.EditTaskPanel.lblTitleParameters&nbsp;<img id="showAddTaskParams" src="../img/iconAdd2.png" style="cursor:pointer;min-width:20px; max-width:30px;" />
                        </h5>
                    </td>
                </tr>
                <tr id="trPAR1">
                    <td>@ResProducts.EditTaskPanel.lblParamName</td>
                    <td><input type="text" id="txtTaskParamName" /></td>
                </tr>
                <tr id="trPAR2">
                    <td>@ResProducts.EditTaskPanel.lblParamDescription</td>
                    <td><textarea id="txtTaskParamDescription"></textarea></td>
                </tr>
                <tr id="trPAR3">
                    <td>@ResProducts.EditTaskPanel.lblParamCategory</td>
                    <td>
                        <select id="ddlTaskParamCategory">
                            <option value="-1"></option>
                            @{
                                KIS.App_Code.ProductParametersCategories parList = new KIS.App_Code.ProductParametersCategories();
                                parList.loadCategories();
                                foreach (var p in parList.Categories)
                                {
                                    <option value="@p.ID">@p.Name</option>
                                }
                            }
                        </select>
                        <a Target="_blank" href="~/Products/ProductParametersCategories/Index" ToolTip="@ResProducts.EditTaskPanel.lblAltParamCategoryManagement">
                            <img src="../img/iconCategory.png" style="min-width:10px; max-width:20px;" />
                        </a>
                    </td>
                </tr>
                <tr id="trPAR4">
                    <td>@ResProducts.EditTaskPanel.lblParamIsFixed</td>
                    <td><input type="checkbox" id="txtTaskParamIsFixed" /></td>
                </tr>
                <tr id="trPAR5">
                    <td>@ResProducts.EditTaskPanel.lblParamIsRequired</td>
                    <td><input type="checkbox" id="txtTaskParamIsRequired" /></td>
                </tr>
                <tr id="trPAR6">
                    <td colspan="2">
                        <img id="imgAddTaskParam" src="../img/iconSave.jpg" style="max-width:30px; min-width:20px; cursor:pointer;" />
                        <img src="../img/iconLoading.gif" style="min-width:20px; max-width:30px;" id="imgLoadAddTaskParam" />
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <img src="../img/iconLoading.gif" style="min-width:20px; max-width:30px;" id="imgLoadParams" />
                        <div id="divTaskParams" />
                    </td>
                </tr>
            </table>
            <div id="divManuals" class="row-fluid">
                <div class="span12" style="text-align:center;">
                    @if (ViewBag.showAddWI)
                    {
                        <h5>@ResProducts.EditTaskPanel.lblWorkInstrucion&nbsp;<img src="~/img/iconAdd2.png" style="cursor:pointer;min-width:20px; max-width:30px;" id="imgAddWorkInstruction" /></h5>
                    }
                    else
                    {
                        <h5>@ResProducts.EditTaskPanel.lblWorkInstrucion&nbsp;<img src="~/img/iconAdd2.png" style="cursor:pointer;min-width:20px; max-width:30px;display:none;" id="imgAddWorkInstruction" /></h5>
                    }
                    <div id="addManual" style="display:none;">
                        <table class="table table-condensed table-striped">
                            <tr>
                                <td>@ResProducts.EditTaskPanel.lblWorkInstrucion</td>
                                <td>
                                    <input list="ddlWorkIstructionsList" id="ddlWorkIstructions">
                                    <datalist id="ddlWorkIstructionsList">
                                        @{KIS.App_Sources.WorkInstructions.WorkInstructionsList lstWI = new KIS.App_Sources.WorkInstructions.WorkInstructionsList();
                                            lstWI.loadWorkInstructionList();
                                            foreach (var wi in lstWI.List)
                                            {
                                                <option data-id="@wi.ID;@wi.Version" value="@wi.Name"></option>
                                            }
                                        }
                                    </datalist>
                                </td>
                            </tr>
                            <tr>
                                <td>@ResProducts.EditTaskPanel.lblWIInitialValidity</td>
                                <td><input type="text" id="manualInitialValidity" /></td>
                            </tr>
                            <tr>
                                <td>@ResProducts.EditTaskPanel.lblWIExpiryDate</td>
                                <td><input type="text" id="manualExpiryDate" /></td>
                            </tr>
                            <tr>
                                <td colspan="2" style="text-align: center;">
                                    <img id="imgAddManual" src="../img/iconSave.jpg" style="max-width:30px; min-width:20px; cursor:pointer;" />
                                    <img id="imgLoadAddManual" src="../img/iconLoading.gif" style="min-width:20px; max-width:30px;" />
                                </td>
                            </tr>
                        </table>
                    </div>
                    <img src="../img/iconLoading.gif" style="min-width:20px; max-width:30px;" id="imgLoadWorkInstructions" />
                    <div id="taskManuals">
                        @{
                            Model.loadWorkInstructions();
                            <table class="table table-striped table-active" id="tblManual">
                                <tbody>
                                    @if (Model.WorkInstructions.Count > 0)
                                    {
                                        <tr>
                                            <td><input type="image" value="@Model.WorkInstructions[0].WI.ID;@Model.WorkInstructions[0].WI.Version" src="../../img/iconDelete.png" style="max-width:20px; min-width:15px; cursor:pointer;" id="imgDeleteWorkInstruction" class="imgDeleteWorkInstruction" /></td>
                                            <td>@Model.WorkInstructions[0].WI.Name</td>
                                            <td>@Model.WorkInstructions[0].InitialDate.ToString("dd/MM/yyyy")</td>
                                            <td>@Model.WorkInstructions[0].ExpiryDate.ToString("dd/MM/yyyy")</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        }
                    </div>
                </div>

            </div>
            <div class="row-fluid">
                <div class="span12" style="text-align:center;">
                    <h5>@ResProducts.EditTaskPanel.lblDefaultOperators&nbsp;<img src="~/img/iconAdd2.png" style="min-width:15px; max-width:30px; cursor:pointer;" id="showAddDefaultOperator" /></h5>
                    <div id="frmAddDefaultOperator">
                        <select id="defaultOperator">
                            <option value=""></option>
                            @{
                                KIS.App_Code.UserList usrList = new KIS.App_Code.UserList();
                                foreach (var m in usrList.listUsers)
                                {
                                    <option value="@m.username">@m.name @m.cognome</option>
                                }
                            }
                        </select><img id="imgSaveDefaultOperator" src="../img/iconSave.jpg" style="max-width:30px; min-width:20px; cursor:pointer;" />
                    </div>
                    <img id="imgLoadDefaultOperators" src="../img/iconLoading.gif" style="min-width:20px; max-width:30px;" />
                    <div id="frmDefaultOperators"></div>
                </div>
            </div>

        </div>
        <div class="span6">
            <div class="row-fluid">
                <div class="span12" style="text-align:center;">
                    <h5>@ResProducts.EditTaskPanel.lblMicrosteps&nbsp;<img src="~/img/iconAdd2.png" style="min-width:15px; max-width:30px; cursor:pointer;" id="showAddMicrostep" /></h5>
                    <div id="frmAddMicrostep">
                        <table class="table table-striped table-hover table-condensed">
                            <tr><td>@ResProducts.EditTaskPanel.lblAddMicrostepName</td><td><input type="text" id="addMicrostepName" /></td></tr>
                            <tr><td>@ResProducts.EditTaskPanel.lblAddMicrostepDescription</td><td><textarea id="addMicrostepDescription" maxlength="255" /></td></tr>
                            <tr><td>@ResProducts.EditTaskPanel.lblAddMicrostepCycleTime</td><td><input type="number" id="addMicrostepCycleTime" /></td></tr>
                            <tr><td>@ResProducts.EditTaskPanel.lblAddMicrostepValueOrWaste</td>
                                <td>
                                    <select id="addMicrostepValueOrWaste">
                                        <option value="V">@ResProducts.EditTaskPanel.lblAddMicrostepValueOrWasteV</option>
                                        <option value="W">@ResProducts.EditTaskPanel.lblAddMicrostepValueOrWasteW</option>
                                        <option value="H">@ResProducts.EditTaskPanel.lblAddMicrostepValueOrWasteH</option>
                                    </select>
                                </td>
                            </tr>
                        </table>
                        
                        <img id="imgSaveMicrostep" src="../img/iconSave.jpg" style="max-width:30px; min-width:20px; cursor:pointer;" />
                    </div>
                    <img id="imgLoadMicrosteps" src="../img/iconLoading.gif" style="min-width:20px; max-width:30px;" />
                    <div id="frmMicrosteps"></div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div>Non sei autorizzato</div>
}
