@model IEnumerable<KIS.App_Code.MeasurementUnit>

@{
    ViewBag.Title = ResMeasurementUnits.Index.lblTitle;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h3>@ResMeasurementUnits.Index.lblTitle</h3>

@if (ViewBag.authW)
{
    <script>
        $(document).ready(function () {
            $("#tblMU").on("click", ".delMU", function () {
                var row = "#row_" + $(this).val();
                $.ajax({
                    url: "@Url.Action("DeleteMeasurementUnit", "MeasurementUnits")",
                    type: 'POST',
                    dataType: "html",
                    data: {
                        uID: $(this).val()
                    },
                    success: function (result) {
                        if (result == "0") {
                            $("#lblModalInfo").html("@ResMeasurementUnits.Index.lblDeleteError");
                            $("#lblModalInfo").dialog({
                                modal: true,
                                title: "Info",
                                open: function (event, ui) {
                                    setTimeout(function () {
                                        $("#lblModalInfo").dialog("close");
                                    }, 2000);
                                }
                            });
                        }
                        else if (result == "1") {
                            $(row).remove();
                        }
                        else if (result == "2") {
                            $("#lblModalInfo").html("@ResMeasurementUnits.Index.lblUnauthorized");
                            $("#lblModalInfo").dialog({
                                modal: true,
                                title: "Info",
                                open: function (event, ui) {
                                    setTimeout(function () {
                                        $("#lblModalInfo").dialog("close");
                                    }, 2000);
                                }
                            });
                        }
                    },
                    error: function (result) {
                        $("#lblModalInfo").html("Error");
                        $("#lblModalInfo").dialog({
                            modal: true,
                            title: "Info",
                            open: function (event, ui) {
                                setTimeout(function () {
                                    $("#lblModalInfo").dialog("close");
                                }, 2000);
                            }
                        });
                    },
                    warning: function (result) {
                    }
                });
            });


            // Edit a measurement unit
            $("#tblMU").on("click", ".editMU", function () {
                var lblType = "#lblType_" + $(this).val();
                var lblDescription = "#lblDescription_" + $(this).val();
                var lblDefault = "#lblDefault_" + $(this).val();
                var saveLoad = "#saveLoad_" + $(this).val();
                $(lblType).hide();
                $(lblDescription).hide();
                $(lblDefault).hide();
                $("#editMU_" + $(this).val()).hide();

                $("#txtType_" + $(this).val()).show();
                $("#txtDescription_" + $(this).val()).show();
                $("#txtIsDefault_" + $(this).val()).show();
                $("#saveMU_" + $(this).val()).show();
            });

            $("#tblMU").on("click", ".saveMU", function () {
                $("img[id^='lblDefault_']").hide();

                var lblType = "#lblType_" + $(this).val();
                var lblDescription = "#lblDescription_" + $(this).val();
                var lblDefault = "#lblDefault_" + $(this).val();
                var saveLoad = "#saveLoad_" + $(this).val();
                var saveMU = "#saveMU_" + $(this).val();
                var editMU = "#editMU_" + $(this).val();
                var startDefClass = 'div[id^="lblDefault_"]';

                $(saveMU).hide();
                $(saveLoad).show();

                var txtType = "#txtType_" + $(this).val();
                var txtDescription = "#txtDescription_" + $(this).val();
                var txtIsDefault = "#txtIsDefault_" + $(this).val();
                var type = $(txtType).val();
                var description = $(txtDescription).val();
                var defa = $(txtIsDefault).prop('checked');

                $.ajax({
                    url: "@Url.Action("EditMeasurementUnits", "MeasurementUnits")",
                    type: 'POST',
                    dataType: "html",
                    data: {
                        uID: $(this).val(),
                        uType: type,
                        uDescription: description,
                        uDefault: defa
                    },
                    success: function (result) {
                        if (result == "0") {
                            $("#lblModalInfo").html("@ResMeasurementUnits.Index.lblDeleteError");
                            $("#lblModalInfo").dialog({
                                modal: true,
                                title: "Info",
                                open: function (event, ui) {
                                    setTimeout(function () {
                                        $("#lblModalInfo").dialog("close");
                                    }, 2000);
                                }
                            });
                        }
                        else if (result == "1") {
                            $(lblType).html(type);
                            $(lblDescription).html(description);
                            $(saveLoad).hide();
                            $(txtType).hide();
                            $(txtDescription).hide();
                            $(txtIsDefault).hide();
                            $(saveMU).hide();

                            $(lblType).show();
                            $(lblDescription).show();
                            if (defa) {
                                $(lblDefault).show();
                            }
                            $(editMU).show();
                        }
                        else if (result == "2") {
                            $(saveLoad).hide();
                            $(txtType).hide();
                            $(txtDescription).hide();
                            $(txtIsDefault).hide();
                            $(saveMU).hide();
                            $(lblType).show();
                            $(lblDescription).show();
                            if (defa) {
                                $(lblDefault).show();
                            }
                            $(editMU).show();
                            $("#lblModalInfo").html("@ResMeasurementUnits.Index.lblUnauthorized");
                            $("#lblModalInfo").dialog({
                                modal: true,
                                title: "Info",
                                open: function (event, ui) {
                                    setTimeout(function () {
                                        $("#lblModalInfo").dialog("close");
                                    }, 2000);
                                }
                            });
                        }
                    },
                    error: function (result) {
                        $("#lblModalInfo").html("Error");
                        $("#lblModalInfo").dialog({
                            modal: true,
                            title: "Info",
                            open: function (event, ui) {
                                setTimeout(function () {
                                    $("#lblModalInfo").dialog("close");
                                }, 2000);
                            }
                        });
                    },
                    warning: function (result) {
                    }
                });
            });


            $("#tblAdd").on("click", "#imgAddMU", function () {
                $(this).fadeOut();
                var defa = $("#txtAddIsDefault").prop('checked');
                $.ajax({
                    url: "@Url.Action("AddMeasurementUnits", "MeasurementUnits")",
                    type: 'POST',
                    dataType: "html",
                    data: {
                        uType: $("#txtAddType").val(),
                        uDescription: $("#txtAddDescription").val(),
                        uDefault: defa
                    },
                    success: function (result) {
                        $("#imgAddMU").fadeIn();
                        if (result == "0") {
                            $("#lblModalInfo").html("@ResMeasurementUnits.Index.lblDeleteError");
                            $("#lblModalInfo").dialog({
                                modal: true,
                                title: "Info",
                                open: function (event, ui) {
                                    setTimeout(function () {
                                        $("#lblModalInfo").dialog("close");
                                    }, 2000);
                                }
                            });
                        }
                        else if (result == "1") {
                            $("#txtAddType").val("");
                            $("#txtAddDescription").val("");
                            $("#txtAddIsDefault").prop('checked', false);
                            window.location.href = window.location.href;
                        }
                        else if (result == "2") {
                            $("#lblModalInfo").html("@ResMeasurementUnits.Index.lblUnauthorized");
                            $("#lblModalInfo").dialog({
                                modal: true,
                                title: "Info",
                                open: function (event, ui) {
                                    setTimeout(function () {
                                        $("#lblModalInfo").dialog("close");
                                    }, 2000);
                                }
                            });
                        }
                    },
                    error: function (result) {
                        $("#imgAddMU").fadeIn();
                        $("#lblModalInfo").html("Error");
                        $("#lblModalInfo").dialog({
                            modal: true,
                            title: "Info",
                            open: function (event, ui) {
                                setTimeout(function () {
                                    $("#lblModalInfo").dialog("close");
                                }, 2000);
                            }
                        });
                    },
                    warning: function (result) {
                        $("#imgAddMU").fadeIn();
                    }
                });
                
            });

        });


    </script>
}

@if (ViewBag.authR)
{
    if (ViewBag.authW)
    {
        <h4>@ResMeasurementUnits.Index.lblAddMU</h4>
        <table class="table table-condensed" id="tblAdd">
            <tr style="vertical-align: middle;">
                <td style="vertical-align: middle;">@ResMeasurementUnits.Index.lblTHType:&nbsp;<input type="text" maxlength="45" id="txtAddType" style="width: 80px;" class="form-text"/></td>
                <td style="vertical-align: middle;">@ResMeasurementUnits.Index.lblTHDescription:&nbsp;<input type="text" maxlength="45" id="txtAddDescription" class="form-text" /></td>
                <td style="vertical-align: middle;">@ResMeasurementUnits.Index.lblTHIsDefault:&nbsp;<input type="checkbox" id="txtAddIsDefault" class="form-check-input" /></td>
                <td style="vertical-align: middle;"><input type="image" id="imgAddMU" src="~/img/iconSave.jpg" style="min-height:20px; max-height:25px;" /></td>
            </tr>
        </table>
    }
    if (Model.Count() > 0)
    {
        <table class="table table-striped table-hover" id="tblMU">
            <thead>
                <tr>
                    <th></th>
                    <th>@ResMeasurementUnits.Index.lblTHType</th>
                    <th>@ResMeasurementUnits.Index.lblTHDescription</th>
                    <th>@ResMeasurementUnits.Index.lblTHIsDefault</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var m in Model)
                {
                    <tr id="row_@m.ID">
                        <td>
                            @if (ViewBag.authW)
                            {
                                <input type="image" src="~/img/iconDelete.png" id="delMU" class="delMU" value="@m.ID" style="min-height:15px; max-height:20px;" />
                                <input type="image" src="~/img/edit.png" id="editMU_@m.ID" class="editMU" value="@m.ID" style="min-height:15px; max-height:20px;" />
                            }
                    </td>
                    <td><div id="lblType_@m.ID">@m.Type</div><input type="text" id="txtType_@m.ID" style="display:none;" value="@m.Type" class="form-text"/></td>
                    <td><div id="lblDescription_@m.ID">@m.Description</div><input type="text" id="txtDescription_@m.ID" style="display:none;" value="@m.Description" class="form-text" /></td>
                    <td>
                        @if (m.IsDefault)
                        {
    <img src="~/img/iconComplete.png" style="min-height:10px; max-height:15px" id="lblDefault_@m.ID" />
    <input type="checkbox" id="txtIsDefault_@m.ID" style="display:none;" class="form-check-input" checked />
    }
    else
    {
        <img src="~/img/iconComplete.png" style="min-height:10px; max-height:15px;display:none;" id="lblDefault_@m.ID" />
    <input type="checkbox" id="txtIsDefault_@m.ID" style="display:none;" class="form-check-input" />

    }
</td>
                    <td>
                        <input type="image" src="~/img/iconSave.jpg" id="saveMU_@m.ID" class="saveMU" value="@m.ID" style="min-height:15px; max-height:20px;display:none;" />
                        <input type="image" src="~/img/iconLoading.gif" id="saveLoad_@m.ID" class="saveMU" value="@m.ID" style="min-height:15px; max-height:20px;display:none;" />
                    </td>
                </tr>
            }
            </tbody>
        </table>
        <div id="lblModalInfo" />
    }
}
else
{
    <div class="row-fluid">
        <div class="span12">
            @ResMeasurementUnits.Index.lblUnauthorized
        </div>
    </div>
}

